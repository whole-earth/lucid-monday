"use strict";function e(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach((function(a){if("default"!==a){var t=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(r,a,t.get?t:{enumerable:!0,get:function(){return e[a]}})}})),r.default=e,Object.freeze(r)}Object.defineProperty(exports,"__esModule",{value:!0});var r=e(require("three"));exports.SpriteAnimator=({startFrame:e,endFrame:a,fps:t,frameName:n,textureDataURL:s,textureImageURL:o,loop:i,numberOfFrames:m,autoPlay:u,animationNames:c,onStart:p,onEnd:l,onLoopEnd:f,onFrame:w,play:h,pause:y,flipX:d,alphaTest:S,asSprite:x})=>{let z={frames:[],meta:{version:"1.0",size:{w:1,h:1},scale:"1"}},g=!1,A=new r.Texture;const F=new r.SpriteMaterial({toneMapped:!1,transparent:!0,map:A,alphaTest:null!=S?S:0}),b=new r.MeshBasicMaterial({toneMapped:!1,side:r.DoubleSide,map:A,transparent:!0,alphaTest:null!=S?S:0}),v=new r.Sprite(F),O=new r.Mesh(new r.PlaneGeometry(1,1),b);let j=F,M=v;const L=new r.Group;L.add(M);let N=window.performance.now(),P=e||0,T=n||"";const _=1e3/(t||30),D=new r.Vector3(1,1,1),E=e=>{D.copy(e)},R=d?-1:1;let k=null==x||x;k=k,k?(j=F,M=v,L.add(v),L.remove(O)):(j=b,M=O,L.remove(v),L.add(O));const C=(e,r)=>{const a=r/e;return M.scale.set(1,a,1),M.scale},G=(e,r)=>{if(null===e){if(r&&m){const e=r.image.width,a=r.image.height,t=e/m,n=a;if(z={frames:[],meta:{version:"1.0",size:{w:e,h:a},scale:"1"}},parseInt(t.toString(),10)===t)for(let e=0;e<m;e++)z.frames.push({frame:{x:e*t,y:0,w:t,h:n},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:t,h:n},sourceSize:{w:t,h:a}})}}else if(r){z=e,z.frames=Array.isArray(e.frames)?e.frames:I();const{w:a,h:t}=q(e.frames).sourceSize,n=C(a,t);E(n),j&&(j.map=r)}var a;r.premultiplyAlpha=!1,A=a=r,j&&(j.map=a),U()},I=()=>{const e={},r=z,a=c;if(a)for(let t=0;t<a.length;t++){e[a[t]]=[];for(const n in r.frames){const s=r.frames[n],o=s.frame,i=o.x,m=o.y,u=o.w,c=o.h,p=s.sourceSize.w,l=s.sourceSize.h;"string"==typeof n&&-1!==n.toLowerCase().indexOf(a[t].toLowerCase())&&e[a[t]].push({x:i,y:m,w:u,h:c,frame:o,sourceSize:{w:p,h:l}})}}return e},U=()=>{if(!z||!j.map)return;const{meta:{size:e},frames:a}=z,{w:t,h:s}=Array.isArray(a)?a[0].sourceSize:n&&a[n]?a[n][0].sourceSize:{w:0,h:0};j.map.wrapS=j.map.wrapT=r.RepeatWrapping,j.map.center.set(0,0),j.map.repeat.set(1*R/(e.w/t),1/(e.h/s));const o=1/((e.h-1)/s);j.map.offset.x=0,j.map.offset.y=1-o,p&&p({currentFrameName:n,currentFrame:P})},q=e=>{if(Array.isArray(e))return e[0];if("object"==typeof e&&null!==e){return e[Object.keys(e)[0]][0]}return{w:0,h:0}};return{group:L,init:async()=>{if(s&&o)await async function(e,a,t){const n=new r.TextureLoader,s=fetch(e).then((e=>e.json())),o=new Promise((e=>{n.load(a,e)}));await Promise.all([s,o]).then((e=>{t(e[0],e[1])}))}(s,o,G);else if(o){const e=new r.TextureLoader,a=await e.loadAsync(o);G(null,a)}},update:()=>{var r,t;null!=(r=z)&&r.frames&&null!=(t=j)&&t.map&&(y||g||!u&&!h||((()=>{if(!z||!j.map)return;const r=window.performance.now(),t=r-N,{meta:{size:s},frames:o}=z,{w:m,h:u}=q(o).sourceSize,c=Array.isArray(o)?o:n?o[n]:[];let p=0,w=0;const h=a||c.length-1;if(P>h&&(P=i&&null!=e?e:0,i?null==f||f({currentFrameName:n,currentFrame:P}):(null==l||l({currentFrameName:n,currentFrame:P}),g=!0),!i))return;if(t<=_)return;N=r-t%_,C(m,u);const y=(s.w-1)/m,d=(s.h-1)/u,{frame:{x:S,y:x},sourceSize:{w:A,h:F}}=c[P],b=1/y,v=1/d;p=R>0?b*(S/A):b*(S/A)-j.map.repeat.x,w=Math.abs(1-v)-v*(x/F),j.map.offset.x=p,j.map.offset.y=w,P+=1})(),w&&w({currentFrameName:T,currentFrame:P})))},playAnimation:()=>{h=!0,y=!1},pauseAnimation:()=>{y=!0},setFrameName:e=>{T!==(n=e)&&n&&(P=0,T=n)}}};
